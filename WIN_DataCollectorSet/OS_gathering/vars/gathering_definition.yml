---
command:
  - $data = New-Object PSObject; foreach ($reg_child_dir in get-ChildItem -path "registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\Microsoft\Windows\PLA"){ $FullPath = Get-Location | format-list Path | Out-String -Stream | Where-Object{$_ -ne ""} | foreach{$_.Remove(0,7)}; $DirName = $reg_child_dir.Name; $index = $DirName.LastIndexOf("\"); if ( $index -ne -1 ){ $Name = $DirName.Substring($index + 1); if ($Name -ne "System") { logman export -n $Name -xml $Name".xml" | Out-Null; $data | Add-Member -MemberType NoteProperty -name $FullPath"\"$Name".xml" -Value @($xmldoc = [xml](Get-Content -Encoding UTF8 $FullPath"\"$Name".xml"); $stringWriter = New-Object System.IO.StringWriter; $xmlWriter = New-Object System.Xml.XmlTextWriter $stringWriter; $xmlWriter.Formatting = "indented"; $xmldoc.WriteTo($xmlWriter); $xmlWriter.Flush(); $stringWriter.Flush(); Write-Output ($stringWriter.ToString() -replace "`r","" -split "`n")) } } } ; Write-output $data | ConvertTo-Json | %{ $_.replace("\u003c","<").replace("\u003e",">")}
